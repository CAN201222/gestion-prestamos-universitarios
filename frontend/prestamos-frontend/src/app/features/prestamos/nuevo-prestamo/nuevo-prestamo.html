<p>nuevo-prestamo works!</p>
<h3>Solicitar Nuevo Préstamo</h3>

<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-body">
        <form [formGroup]="prestamoForm" (ngSubmit)="onSubmit()">

          <div class="alert alert-danger" *ngIf="error">
            {{ error }}
          </div>
           <div class="alert alert-success" *ngIf="success">
            ¡Préstamo solicitado con éxito! Serás redirigido.
          </div>

          <div class="mb-3">
            <label for="libro" class="form-label">Libro</label>
            <select id="libro" class="form-select" formControlName="libro"
                    [ngClass]="{ 'is-invalid': f['libro'].touched && f['libro'].errors }">
              <option [ngValue]="null" disabled>Selecciona un libro...</option>
              <ng-container *ngIf="libros$ | async as libros">
                <option *ngFor="let libro of libros" [ngValue]="libro.id" 
                        [disabled]="libro.disponibles <= 0">
                  {{ libro.titulo }} (Disponibles: {{ libro.disponibles }})
                </option>
              </ng-container>
            </select>
            <div *ngIf="f['libro'].touched && f['libro'].errors" class="invalid-feedback">
              Debes seleccionar un libro.
            </div>
          </div>
          
          <div class="mb-3">
            <label for="fecha_devolucion_prevista" class="form-label">Fecha de Devolución</label>
            <input type="date" id="fecha_devolucion_prevista" class="form-control" formControlName="fecha_devolucion_prevista"
                   [ngClass]="{ 'is-invalid': f['fecha_devolucion_prevista'].touched && f['fecha_devolucion_prevista'].errors }">
            <div *ngIf="f['fecha_devolucion_prevista'].touched && f['fecha_devolucion_prevista'].errors" class="invalid-feedback">
              La fecha es requerida.
            </div>
          </div>
          
          <button type="submit" class="btn btn-primary w-100" [disabled]="prestamoForm.invalid || loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            {{ loading ? 'Solicitando...' : 'Solicitar' }}
          </button>
        </form>
      </div>
    </div>
  </div>
</div>